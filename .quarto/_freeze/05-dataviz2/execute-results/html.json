{
  "hash": "b507a3d248e686d3baa609653d19b7c5",
  "result": {
    "markdown": "# Data viz II {#sec-dataviz2}\n\n\n\n\n\n## Intended Learning Outcomes {.unnumbered}\n\nBy the end of this chapter you should be able to:\n\n-   choose an appropriate plot for continuous variables \n-   choose an appropriate plot for a mix of continuous/categorical variables \n-   create a basic version of an appropriate plot\n-   apply extra layers to change the appearance of the plot\n\nIn this chapter, we continue our journey of appropriate plots. Last week, we examined which **plots are appropriate for categorical variables**. Today, we'll focus on continuous variables and which plots to choose with a **mix of continuous and categorical variables**.\n\n\n\n## [Individual Walkthrough]{style=\"color: #F39C12; text-transform: uppercase;\"} {.unnumbered}\n\n\n## Activity 1: Set-up and data for today\n\n* We are still working with the data by Pownall et al. (2023). **Open the project**.\n* You could use the same `.Rmd` file as last week if you want to keep all plotting in one document or create a new `.Rmd` to separate plots for categorical and continuous variables. Up to you.\n* The aggregated data is the same as last week. It should be in your project folder but in case it got lost, download the csv again and place it in your project folder: [data_prp_for_ch4.csv](data/data_prp_for_ch4.csv \"download\").\n* If you need a reminder about the data and variables, have a look at the codebook and/or @sec-download_data_ch1.\n\n\n\n## Activity 2: Load in libraries, read in data, and adjust data types\n\nToday, we need to load the package `tidyverse`, and read in the data `data_prp_ch4.csv`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## packages \n???\n\n## data\ndata_prp_viz <- ???\n```\n:::\n\n\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"}\n\n## Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndata_prp_viz <- read_csv(\"data_prp_for_ch4.csv\")\n```\n:::\n\n\n:::\n\n\n\n\n\n\n\n\nThis is the same code as last week. We need to turn our categorical variables into factors to make plotting easier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_prp_viz <- data_prp_viz %>% \n  mutate(Gender = factor(Gender,\n                         levels = c(2, 1, 3),\n                         labels = c(\"females\", \"males\", \"non-binary\")),\n         Secondyeargrade = factor(Secondyeargrade,\n                                  levels = c(1, 2, 3, 4, 5),\n                                  labels = c(\"≥ 70% (1st class grade)\", \"60-69% (2:1 grade)\", \"50-59% (2:2 grade)\", \"40-49% (3rd class)\", \"< 40%\")),\n         Plan_prereg = factor(Plan_prereg,\n                              levels = c(1, 3, 2),\n                              labels = c(\"Yes\", \"Unsure\", \"No\")),\n         Closely_follow = factor(Closely_follow,\n                                 levels = c(2, 3),\n                                 labels = c(\"Followed it somewhat\", \"Followed it exactly\")),\n         Research_exp = factor(Research_exp),\n         Pre_reg_group = factor(Pre_reg_group))\n```\n:::\n\n\n\n::: {.callout-tip}\n\nIf you are working within the same `.Rmd` file as last week, you can skip these initial steps but you have to run the code you had already placed at the start of last-week's `.Rmd` file to load tidyverse into the library, read in the data, and convert some of the variables into factors.\n\n:::\n\n\n## Activity 3: Histogram (`geom_histogram()`) {#sec-hist}\n\nIf you want to show the **distribution of a continuous variable**, you can use a histogram. As with every plot, you need at least 3 layers to create a base version of the plot. Similar to `geom_bar()`, `geom_histogram()` only requires an `x` variable as it does the counting \"in the background\".\n\nA histogram divides the data into \"bins\" (i.e., groupings displayed in a single bar). These bins are plotted along the x-axis, with the y-axis showing the count of observations in each bin. It's basically a barchart for continuous variables.\n\nLet's have a look at the age distribution in our dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Age)) +\n  geom_histogram() \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n:::\n\n::: {.cell-output-display}\n![Default histogram](05-dataviz2_files/figure-html/fig-hist-1.png){#fig-hist width=672}\n:::\n:::\n\n\n\nThe default **number of bins** is 30 (as shown in @fig-hist above). Changing the number of bins (argument `bins`) allows for more or less fine-tuning of the data. A higher number of bins results in more detailed granularity.\n\nPerhaps it’s more intuitive to modify the **width of each bin** using the `binwidth` argument. For example, `binwidth = 1` for the age category would mean each \"age group\" represents 1 year, while `binwidth = 5` would group ages into 5-year spans. The plots below show modifications for both `bins` and `binwidth`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#less finetuning\nggplot(data_prp_viz, aes(x = Age)) +\n  geom_histogram(bins = 10) \n\n# more fineturning\nggplot(data_prp_viz, aes(x = Age)) +\n  geom_histogram(binwidth = 1) \n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing non-finite outside the scale range (`stat_bin()`).\nRemoved 2 rows containing non-finite outside the scale range (`stat_bin()`).\n```\n:::\n\n::: {.cell-output-display}\n![Bins vs binwidth arguments](05-dataviz2_files/figure-html/fig-bins-1.png){#fig-bins width=672}\n:::\n:::\n\n\nThe **warning message** tells us 2 row of data were removed due to containing `non-finite values outside the scale range`. Have a look at the age column in `data_prp_viz` to see if you can decipher the warning message.\n\nThe rows were removed because <select class='webex-select'><option value='blank'></option><option value='x'>they fall outside of the plot range</option><option value='answer'>they contain missing values</option></select>.\n\nColours are manipulated slightly differently than in the barchart. Click through each tab to see how you can modify colours, axis labels, margins, and breaks, and apply a different theme.\n\n\n::: {.panel-tabset}\n\n## Colour\n\nWe can change the plot colours by adding a **fill argument** and a **colour argument**. The `fill` argument changes the colour of the bars, while the `colour` argument modifies the outline of the bars. Note that these arguments are **added directly to the `geom_histogram()`**, rather than within the overall `aes()`, as we did with the barchart.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Age)) +\n  geom_histogram(binwidth = 1, fill = \"#586cfd\", colour = \"#FC58BE\")\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n::: callout-tip\n\nYou could use:\n\n* Hex codes for `fill` and `colour`, as we did here: `geom_histogram(binwidth = 1, fill = \"#586cfd\", colour = \"#FC58BE\")`. If you want to create your own colours, check out [this website](https://www.hexcolortool.com/){target=\"_blank\"}.\n\n* Pre-defined colour names: `geom_histogram(binwidth = 1, fill = \"purple\", colour = \"green\")`. See the full list [here](https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/){target=\"_blank\"}.\n\n:::\n\n\n## Axes labels, margins, and breaks\n\nHere we **removed the label** for the y axes `Count` (to show you some variety) and **modified the breaks**. The y-axis is now displayed in increasing steps of 5 (rather than 10), and the x-axis has 1-year increments instead of 5. \n\nNotice how the `breaks =` argument changes the labels of the break ticks but not the scale limits. You can adjust the limits of the scale using the `limits =` argument. To exaggerate, we set the limits to 15 and 50. See how the values from 15 to 19, and 44 to 50 do not have labels? You would need to adjust that using the `breaks =` argument.\n\n\nThe `expansion()` function removes the gap between the x-axis and the bars. It is exactly the same code we used in @sec-dataviz.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Age)) +\n  geom_histogram(binwidth = 1, fill = \"#586cfd\", colour = \"#FC58BE\") +\n  labs(x = \"Age (in years)\", # renaming x axis label\n       y = \"\") + # removing the y axis label\n  scale_y_continuous(\n    # remove the space below the bars (first number), but keep a tiny bit (5%) above (second number)\n    expand = expansion(mult = c(0, 0.05)),\n    # changing break points on y axis\n    breaks = seq(from = 0, to = 30, by = 5)\n    ) +\n  scale_x_continuous(\n    # changing break points on x axis\n    breaks = seq(from = 20, to = 43, by = 1),\n    # Experimenting with\n    limits = c(15, 50)\n    )\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Themes\n\nLet's experiment with the themes. For this plot we have chosen `theme_bw()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Age)) +\n  geom_histogram(binwidth = 1, fill = \"#586cfd\", colour = \"#FC58BE\") +\n  labs(x = \"Age (in years)\", # renaming x axis label\n       y = \"\") + # removing the y axis label\n  scale_y_continuous(\n    # remove the space below the bars (first number), but keep a tiny bit (5%) above (second number)\n    expand = expansion(mult = c(0, 0.05)),\n    # changing break points on y axis\n    breaks = seq(from = 0, to = 30, by = 5)\n    ) +\n  scale_x_continuous(\n    # changing break points on x axis\n    breaks = seq(from = 19, to = 44, by = 1)\n    ) +\n  # pick a theme\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n:::\n\n\n## Activity 4: Scatterplot (`geom_point()`) {#sec-scatter}\n\nScatterplots are appropriate when you want to plot **two continuous variables**. Here, we want to display the relationship between Acceptance of QRPs at Time point 1 and Time point 2. The default scatterplot can be created with `geom_point()`.\n\nWe can also **add a trendline** by using `geom_smooth()`. The default trendline is `loess`. If you want a linear trendline, you would need to add `method = \"lm\"` inside the `geom_smooth()` function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = QRPs_Acceptance_Time1_mean, y = QRPs_Acceptance_Time2_mean)) +\n  geom_point() +\n  geom_smooth()\n\nggplot(data_prp_viz, aes(x = QRPs_Acceptance_Time1_mean, y = QRPs_Acceptance_Time2_mean)) +\n  geom_point() +\n  geom_smooth(method = lm)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Default Scatterplot with added trendline - loess (left) and linear (right)](05-dataviz2_files/figure-html/fig-scatter-1.png){#fig-scatter width=672}\n:::\n:::\n\n\n\n\nCustomising the colour of a scatterplot is slightly different from the other plots we’ve encountered so far. Technically, the point is not a \"filled-in black area\" but rather an extremely wide outline of a circle. Therefore, we cannot use the usual `fill` argument and instead need to use the `colour` argument, similar to how we customised the outline of the histogram. \n\nSee the tabs below to learn how to change the colour for all points or how to adjust the colour based on groupings.\n\n\n::: {.panel-tabset}\n\n\n## Colour for all points\n\nIf we want to **change the colour of all the points**, we can add the `colour` argument to the `geom_point()` function. Likewise, to change the **colour of the trendline**, we would also use the `colour` argument. Here, we used pre-defined colour names, but HEX codes would work just as well.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# colour of all points and the trendline\nggplot(data_prp_viz, aes(x = QRPs_Acceptance_Time1_mean, y = QRPs_Acceptance_Time2_mean)) +\n  geom_point(colour = 'magenta') +\n  geom_smooth(method = lm, colour = 'turquoise')\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n## Colour with grouping\n\nIf we want the points to **change colour based on another grouping variable**, the `colour` argument should go inside the `aes()`. If you don’t want to define the colours manually, you can use a colour palette like Brewer (`scale_colour_brewer()`) or Viridis (`scale_colour_viridis_d()`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## adding grouping variable Pre_reg_group and changing the colour values manually\nggplot(data_prp_viz, aes(x = QRPs_Acceptance_Time1_mean, y = QRPs_Acceptance_Time2_mean, colour = Pre_reg_group)) +\n  geom_point() +\n  geom_smooth(method = lm) +\n  scale_colour_manual(values = c('mediumvioletred', 'steelblue1'))\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n\n## Legend title and labels\n\nYou can tidy the legend title and group labels using the `scale_colour_?` function, depending on the palette you’re using (e.g., `scale_colour_manual()`, `scale_colour_brewer` and many more).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = QRPs_Acceptance_Time1_mean, y = QRPs_Acceptance_Time2_mean, colour = Pre_reg_group)) +\n  geom_point() +\n  geom_smooth(method = lm) +\n  scale_colour_manual(values = c('mediumvioletred', 'steelblue1'),\n                      name = \"Pre-registered Dissertation\",\n                      labels = c(\"Yes\", \"No\"))\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n:::\n\n::: {.callout-note icon=\"false\"} \n\n## Your Turn\n\nAll other layers remain exactly the same as in other plots. Try adding layers to make the plot above prettier:\n\n* [ ] 1. relabel axes x and y\n* [ ] 2. set the x and y axis range from 1 to 7\n* [ ] 3. move the legend to a different position (either top, left, or bottom)\n* [ ] 4. add a theme\n\n\n::: {.callout-note collapse=\"true\" icon=\"false\"} \n\n## Hints\n\n1. can be done in 2 different ways - labs() or scale_x_?\n2. we did that for the histogram\n3. We did that for the barcharts\n4. pick a theme you like\n\n\n::: {.callout-note collapse=\"true\" icon=\"false\"} \n\n## More hints\n\nIf you are experiencing issues with the legend position and theme, try modifying the order of the layers.\n\n:::\n\n:::\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"} \n\n## Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = QRPs_Acceptance_Time1_mean, y = QRPs_Acceptance_Time2_mean, colour = Pre_reg_group)) +\n  geom_point() +\n  geom_smooth(method = lm) +\n  scale_colour_manual(values = c('mediumvioletred', 'steelblue1'),\n                      name = \"Pre-registered Dissertation\",\n                      labels = c(\"Yes\", \"No\")) +\n  labs (x = \"Acceptance of Questionable Research Practices (Time 1)\", \n        y = \"Acceptance of Questionable Research Practices (Time 2)\") +\n  theme_light() + # place before moving the legend position\n  theme(legend.position = \"top\") # move legend to the top\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n:::\n\n:::\n\n\n\n\n\n\n## Activity 5: Boxplot (`geom_boxplot()`)\n\nA boxplot is one of the options to display a **continuous variable with categorical grouping variable**. Here, we want to create a boxplot to explore whether students' understanding of open science varies based on whether or not they have research experience. Our default boxplot would look like this:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# default boxplot\nggplot(data_prp_viz, aes(x = Research_exp, y = Time1_Understanding_OS)) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\nTada! As usual, we can enhance the plot by adding various layers. Click on each tab below to see how.\n\n\n::: {.panel-tabset}\n\n## Colour\n\nWe can change the colour by adding a `fill` argument inside the `aes()`. To customise the colours further, we can add a `scale_fill_?` layer. If you have specific colours in mind, use `scale_fill_manual()`. If you prefer pre-defined palettes, such as Brewer, you can use `scale_fill_brewer()`.\n\nBtw, this is exactly the same code we used for the barcharts.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Research_exp, y = Time1_Understanding_OS, fill = Research_exp)) +\n  geom_boxplot() +\n  # customise colour\n  scale_fill_brewer(palette = \"Dark2\")\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n## Axes labels\n\nWe need to relabel the axes. The function to use depends on the variable type. Here, we need `scale_x_discrete()` for the x-axis and `scale_y_continuous()` for the y-axis. We can also tidy up the group labels and adjust the breaks on the y-axis (e.g., in steps of 1 instead of 2) within these same functions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Research_exp, y = Time1_Understanding_OS, fill = Research_exp)) +\n  geom_boxplot() +\n  scale_fill_brewer(palette = \"Dark2\") +\n  scale_x_discrete(\n    # changing the label of x\n    name = \"Research Experience\",\n    # changing the group labels of the 2 groups\n    labels = c(\"Yes\", \"No\")) + \n  scale_y_continuous(\n    # changing name of the y axis\n    name = \"Confidence in Understanding Open Science (Time 1)\",\n    # changing break labels\n    breaks = c(seq(from = 1, to = 7, by = 1))\n  )\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Legend and Theme\n\nThe legend is superfluous; best to take it off. As before, we can remove the legend by adding the argument `guide = \"none\"` to the `scale_fill_?` function.\n\nLet's pick a theme we haven't used yet: `theme_dark()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Research_exp, y = Time1_Understanding_OS, fill = Research_exp)) +\n  geom_boxplot() +\n  scale_fill_brewer(palette = \"Dark2\",\n                    # removing the legend\n                    guide = \"none\") +\n  scale_x_discrete(\n    name = \"Research Experience\",\n    labels = c(\"Yes\", \"No\")) + \n  scale_y_continuous(\n    name = \"Confidence in Understanding Open Science (Time 1)\",\n    breaks = c(seq(from = 1, to = 7, by = 1))\n  ) +\n  # pick a theme\n  theme_dark()\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n\n\n## Activity 6: Violin plot (`geom_violin()`)\n\nAn alternative way to display a **continuous variable with a categorical grouping variable** is a violin plot. Here, we want to create a violin plot to explore whether the perception of supervisor support depends on whether students plan to pre-register their dissertation. Our default violin plot would look like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# default boxplot\nggplot(data_prp_viz, aes(x = Plan_prereg, y = Mean_Supervisor_Support)) +\n  geom_violin()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 3 rows containing non-finite outside the scale range\n(`stat_ydensity()`).\n```\n:::\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n::: {.callout-note icon=\"false\"} \n\n## Your Turn\n\nAdjusting the violin plot would be exactly the same as the boxplot. Try to add layers to the base plot above to\n\n* [ ] change the colours either manually or using a pre-defined colour palette \n* [ ] tidy the axes labels and group names\n* [ ] in case a legend appears, take it off\n* [ ] add a theme\n\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"} \n\n## One possible Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Plan_prereg, y = Mean_Supervisor_Support, fill = Plan_prereg)) +\n  geom_violin() +\n  scale_fill_manual(values = c('mediumspringgreen', 'orangered', 'slateblue'),\n                    # removing the legend\n                    guide = \"none\") +\n  scale_x_discrete(name = \"Plan to pre-register the dissertation\") + \n  scale_y_continuous(\n    name = \"Perceived Supervisory Support\",\n    breaks = c(seq(from = 1, to = 7, by = 1))\n  ) +\n  # pick a theme\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 3 rows containing non-finite outside the scale range\n(`stat_ydensity()`).\n```\n:::\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n:::\n\n:::\n\n\n## Activity 7: Violin-boxplots\n\nSo far, we’ve only added one `geom_?` layer to our plots. However, thanks to ggplot's layered system, we can add multiple geoms, for example, when creating a violin-boxplot.\n\nRemember, the order of the layers can sometimes make a difference. We've seen this already - adding a theme at the end can override earlier arguments like the legend position. Similarly, `ggplot + violinplot + boxplot` will look different from `ggplot + boxplot + violinplot`.\n\nLet's use the example of QRPs at timepoint 2 and a grouping variable of Second-year Grade.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Secondyeargrade, y = QRPs_Acceptance_Time2_mean)) +\n  geom_violin() +\n  geom_boxplot()\n\n\nggplot(data_prp_viz, aes(x = Secondyeargrade, y = QRPs_Acceptance_Time2_mean)) +\n  geom_boxplot() +\n  geom_violin()\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Default violin-boxplot: Order of the layer matters](05-dataviz2_files/figure-html/fig-vb_bv-1.png){#fig-vb_bv width=672}\n:::\n:::\n\n\n\nSee the tabs below to learn how to customise various elements, such as the width of the boxes, and the colour or opacity.\n\n\n::: {.panel-tabset}\n\n## Width of the boxes\n\nIf we want to get any information from the boxplot, we need to place it \"on top of\" the violin plot. But still, the boxplot is pretty wide and covers important details from the violin plot. To make the information more visible, we can **adjust the width of the boxes**. Finding an appropriate width might take some trial and error.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Secondyeargrade, y = QRPs_Acceptance_Time2_mean)) +\n  geom_violin() +\n  geom_boxplot(width = 0.2)\n```\n\n::: {.cell-output-display}\n![Default violin-boxplot: adjusting width of the box](05-dataviz2_files/figure-html/fig-vb_width-1.png){#fig-vb_width width=672}\n:::\n:::\n\n\n## Colour\n\nAdding colour should be pretty straightforward by now. The code is no different from what we used for the boxplot or violin plot. We need to add the `fill` argument within the `aes()`, along with a `scale_fill_?` layer.\n\nHowever, we can further customise the plot by adding an **opacity argument** using `alpha` to the violin plot geom.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Secondyeargrade, y = QRPs_Acceptance_Time2_mean, fill = Secondyeargrade)) +\n  geom_violin(alpha = 0.4) + # alpha for opacity\n  geom_boxplot(width = 0.2) + # change width of the boxes\n  scale_fill_brewer(palette = \"RdPu\") # customise colour\n```\n\n::: {.cell-output-display}\n![Violin-boxplot with a different colour palette](05-dataviz2_files/figure-html/fig-vb_colour-1.png){#fig-vb_colour width=672}\n:::\n:::\n\n\n:::\n\n::: {.callout-note icon=\"false\"} \n\n## Your Turn\n\n* [ ] Change the x- and y-axis labels\n* [ ] Remove the legend\n* [ ] add a theme\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"} \n\n## One possible Solution \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Secondyeargrade, y = QRPs_Acceptance_Time2_mean, fill = Secondyeargrade)) +\n  geom_violin(alpha = 0.4) +\n  geom_boxplot(width = 0.2) +\n  scale_fill_brewer(palette = \"RdPu\",\n                    guide = \"none\") + # removes the legend\n  # change labels of x and y\n  labs (x = \"Second-year Grade\", y = \"Acceptance of Questionable Research Practices (Time 2)\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n:::\n\n:::\n\n\n## Activity 8: Faceting - adding another grouping variable\n\nFaceting is really useful when you have subsets in the data. We will apply it to the violin-boxplot from above, but you could add this layer to pretty much any plot. The function to split the plots into facets is called `facet_wrap()`.\n\nLet's **add another grouping variable**, `Pre_reg_group`, to create separate plots for the yes and no groups.\n\nSince the group labels on the x-axis are quite long, we will need to adjust them for better readability. Adding `guide = guide_axis(n.dodge = 2)` to the `scale_x_discrete()` function helps to display labels across multiple rows.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_prp_viz, aes(x = Secondyeargrade, y = QRPs_Acceptance_Time2_mean, fill = Secondyeargrade)) +\n  geom_violin(alpha = 0.5) +\n  geom_boxplot(width = 0.2) +\n  scale_fill_brewer(palette = \"RdPu\",\n                    guide = \"none\") + \n  labs (x = \"Second-year Grade\", y = \"Acceptance of Questionable Research Practices (Time 2)\") +\n  theme_classic() +\n  facet_wrap(~Pre_reg_group) + # faceting to split into subplots for yes and no\n  scale_x_discrete(guide = guide_axis(n.dodge = 2)) # want display labels in 2 rows\n```\n\n::: {.cell-output-display}\n![Pretty violin-boxplot split into pre-registration groups (yes and no)](05-dataviz2_files/figure-html/fig-vb_pretty_facet-1.png){#fig-vb_pretty_facet width=672}\n:::\n:::\n\n\n::: {.callout-tip}\n\nYou may have noticed that the labels of `Pre_reg_group` are displayed as numbers (1 and 2). If this bugs you, fix the labels in the data object. This would be less hassle than trying to adjust the facet headings in the plot.\n\n:::\n\n\n\n::: {.callout-tip collapse=\"true\" icon=\"false\"}\n\n## Special case: Variables with subscales\n\nFor example, if we want to show the relationship between SATs scores at Timepoints 1 and 2, separately for all four subscales of the SATs questionnaire, we need to wrangle the data so that the scores for Time 1 and Time 2 are in separate columns, but each participant has four rows (one for each subscale). The dataframe should look like this:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(data_facet, n=5)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|Code |Subscale            |    Time1|    Time2|\n|:----|:-------------------|--------:|--------:|\n|Tr10 |Affect              | 4.000000| 3.500000|\n|Tr10 |CognitiveCompetence | 5.166667| 4.166667|\n|Tr10 |Value               | 6.000000| 3.000000|\n|Tr10 |Difficulty          | 3.571429| 2.857143|\n|Bi07 |Affect              | 3.833333| 3.166667|\n\n</div>\n:::\n:::\n\n\n\n::: {.callout-note icon=\"false\"} \n\n## Your Turn\n\nCreate a new data object `data_facet` and wrangle the data from `data_prp_viz` so that it looks like the table above.\n\n::: {.callout-note collapse=\"true\" icon=\"false\"}\n\n## Broad hints\n\n* **Step 1**: select variables of interest from `data_prp_viz`\n* **Step 2**: pivot the data\n* **Step 3**: try to access information on subscales and timepoints from the variable names\n* **Step 4**: pivot in the other direction\n\n:::\n\n::: {.callout-note collapse=\"true\" icon=\"false\"}\n\n## More specific hints\n\n* **Step 1**: The variables of interest are the participants' ID and all columns that start with SATS.\n* **Step 2**: Pivot all columns, except the participant ID, from wide to long format.\n* **Step 3**: Get some inspiration from Activity 4 in {#sec-wrangling2}.\n* **Step 4**: At this point, subscales and timepoints should be in long format. However, only the subscale information should remain in long format. Pivot the data from long to wide format so that Time 1 and Time 2 are in separate columns.\n\n:::\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"}\n\n## Solution\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_facet <- data_prp_viz %>% \n  select(Code, starts_with(\"SATS\")) %>% \n  pivot_longer(cols = starts_with(\"SATS\"), names_to = \"Variable\", values_to = \"Mean_Scores\") %>% \n  separate(Variable, into = c(NA, \"Subscale\", \"Timepoint\", NA), sep = \"_\") %>% \n  pivot_wider(names_from = Timepoint, values_from = Mean_Scores)\n```\n:::\n\n\n:::\n\n:::\n\nNow we can build a scatterplot with facets for the subscales.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_facet, aes(x = Time1, y = Time2)) +\n  geom_point() +\n  facet_wrap(~Subscale)\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n\n\n\n\n\n## [Test your knowledge]{style=\"color: #F39C12; text-transform: uppercase;\"} {.unnumbered}\n\n\n### Knowledge check {.unnumbered}\n\n\n#### Question 1 {.unnumbered}\n\nWhy would this line of code not create a barplot, assuming you already loaded all data and libraries and you spelt the data and column names correctly?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(summarydata, aes(x = sex)) +\n  geom_barplot()\n```\n:::\n\n\n<div class='webex-radiogroup' id='radio_OTUSSYGMGM'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OTUSSYGMGM\" value=\"answer\"></input> <span>because there is no geom_barplot() and it should be geom_bar()</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OTUSSYGMGM\" value=\"x\"></input> <span>because you have piped the barplot and not added it</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OTUSSYGMGM\" value=\"x\"></input> <span>because you have not included a y axis</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OTUSSYGMGM\" value=\"x\"></input> <span>because this would create a histogram</span></label></div>\n\n\n\n\n#### Question 2 {.unnumbered}\n\nIf I wanted precisely 5 bars in my histogram, what argument would I use? \n\n<div class='webex-radiogroup' id='radio_HGCPXEMFEM'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_HGCPXEMFEM\" value=\"x\"></input> <span>ggplot() + geom_histogram(binwidth = 5)</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_HGCPXEMFEM\" value=\"answer\"></input> <span>ggplot() + geom_histogram(bins = 5)</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_HGCPXEMFEM\" value=\"x\"></input> <span>ggplot() + geom_histogram()</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_HGCPXEMFEM\" value=\"x\"></input> <span>ggplot() + geom_histogram(bars = 5)</span></label></div>\n\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"}\n\n## Explain this answer\n\n* `ggplot() + geom_histogram(bins = 5)`. This is the **correct** answer as you are asking ggplot2 to give you the plot organised into 5 bins. \n* `ggplot() + geom_histogram(bars = 5)`. This is incorrect as you bars is not the right argument name. You want 5 bars, but the argument is bins. \n* `ggplot() + geom_histogram(binwidth = 5)`. This is incorrect as binwidth controls the x-axis range to include per bar, rather than the number of bars. \n* `ggplot() + geom_histogram()`. This is incorrect as you did not control the number of bins, so it will default to 30. \n\n:::\n\n\n#### Question 3 {.unnumbered}\n\nYou want to create a scatterplot to show the correlation between two continuous variables, which geom would you use? \n\n<div class='webex-radiogroup' id='radio_IRUKLIHLSB'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_IRUKLIHLSB\" value=\"answer\"></input> <span>geom_point()</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_IRUKLIHLSB\" value=\"x\"></input> <span>geom_violin()</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_IRUKLIHLSB\" value=\"x\"></input> <span>geom_histogram()</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_IRUKLIHLSB\" value=\"x\"></input> <span>geom_boxplot()</span></label></div>\n\n\n\n#### Question 4 {.unnumbered}\n\nTrue or False? To showcase different groups in a scatterplot, you could specify a grouping variable using the `fill` argument to change the colour of the points. <select class='webex-select'><option value='blank'></option><option value=''>TRUE</option><option value='answer'>FALSE</option></select>\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"} \n\n## Explain this answer\n\nHave a look in the scatterplot section again. There, we explained that we cannot \"colour in\" the area of the points using `fill`, but need to change the outline colour of the points with `colour` instead.\n:::\n\n\n### Error mode {.unnumbered}\n\nSome of the code chunks contain mistakes and result in errors, while others do not produce the expected results. Your task is to identify any issues, explain why they occurred, and, if possible, fix them.\n\nLet's go back to the Palmer penguins for this part.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'palmerpenguins'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:datasets':\n\n    penguins, penguins_raw\n```\n:::\n:::\n\n\n\n#### Question 5 {.unnumbered}\n\nWe want to plot the number of penguins across the different islands.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = islands)) %>% \n  geom_bar()\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in `geom_bar()`:\n! `mapping` must be created by `aes()`.\nℹ Did you use `%>%` or `|>` instead of `+`?\n```\n:::\n:::\n\n\nThe error message is incredibly useful. So that should be an easy fix!\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"}\n\n## Explain the solution\n\nTo fix the error, all we need to do is turn the pipe `%>%` into a plus `+`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = island)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n:::\n\n\n#### Question 6 {.unnumbered}\n\nWe want to create a violin-boxplot showing the bill length across species, separately for male and female penguins.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_no_na <- penguins %>% \n  drop_na(island, flipper_length_mm, sex)\n\nggplot(penguins_no_na, aes(x = island, y = flipper_length_mm, fill = sex)) +\n  geom_violin() +\n  geom_boxplot(width = 0.2) +\n  labs(x = \"Island\", y = \"Bill length in mm\") +\n  facet_wrap(~sex)\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\nWe got a plot, but is it the one we aimed for? <select class='webex-select'><option value='blank'></option><option value='x'>yes</option><option value='answer'>no</option></select>\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"}\n\n## Explain the solution\n\nThis was a tricky one. The code runs, so we think everything is fine. Despite having re-labelled the y-axis \"Bill length in mm\", it's really showing the flipper length. Did you spot this???\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_no_na <- penguins %>% \n  drop_na(island, bill_length_mm, sex)\n\nggplot(penguins_no_na, aes(x = island, y = bill_length_mm, fill = sex)) +\n  geom_violin() +\n  geom_boxplot(width = 0.2) +\n  labs(x = \"Island\", y = \"Bill length in mm\") +\n  facet_wrap(~sex)\n```\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n:::\n\n#### Question 7 {.unnumbered}\n\nThis time, we want to show the relationship between flipper length and body mass of the penguins. The following code runs, but the x- and y-axes are misbehaving somehow. Not what we wanted. Any idea why?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g, colour = island)) +\n  geom_point() +\n  scale_colour_viridis_d(name = \"Island\") +\n  scale_y_discrete(name = \"Body mass in g\",\n                     breaks = seq(2500, 6500, 500),\n                     limits = c(2500, 6500)) +\n  scale_x_discrete(name = \"Flipper length in mm\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in scale_y_discrete(name = \"Body mass in g\", breaks = seq(2500, : Continuous limits supplied to discrete scale.\nℹ Did you mean `limits = factor(...)` or `scale_*_continuous()`?\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](05-dataviz2_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n\n::: {.callout-caution collapse=\"true\" icon=\"false\"}\n\n## Explain the solution\n\nWe used the wrong function for continuous variables. The error message helpfully asked us if we either meant to turn something into a factor or use `scale_*_continuous()` instead.\n\nIndeed, we used  `scale_x_discrete` and `scale_y_discrete`, instead of `scale_x_continuous` and `scale_y_continuous`. We must honour the variable type when we customise plots, so always check what type of variable is on each axis and which function lets you edit it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g, colour = island)) +\n  geom_point() +\n  scale_colour_viridis_d(name = \"Island\") +\n  scale_y_continuous(name = \"Body mass in g\",\n                     breaks = seq(2500, 6500, 500),\n                     limits = c(2500, 6500)) +\n  scale_x_continuous(name = \"Flipper length in mm\")\n```\n:::\n\n:::\n\n",
    "supporting": [
      "05-dataviz2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}